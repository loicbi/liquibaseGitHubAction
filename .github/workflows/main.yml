name: CI_CD_TEST
# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the develop branch
  push:
    branches: [ 'develop' ]
    paths: [ 'dbscripts/deploy/**']

  workflow_dispatch:
  
jobs:
  liquibase-action-test-1:
    runs-on: ubuntu-latest
    environment: DEV
    steps:
      - uses: actions/checkout@v2
      # note the below assumes that a host path or volume is mounted into the container at ./Docker (or action will fail) !!!
      
      - name: RUN 'LIQUIBASE STATUS IN A DOCKER CONTAINER'
        uses: docker://liquibase/liquibase:latest
        with:
          args: --url=${{ secrets.DL_SNOWFLAKE_URL }} --changeLogFile=/dbscripts/masterChanlgeLog.xml --username=${{ secrets.SNOWFLAKE_USERNAME }} --password=${{ secrets.SF_PASSWORD }} --driver=${{ secrets.SF_DRIVER }} --defaultSchemaName=${{ secrets.SNOWFLAKE_SCHEMA_NAME }} status

#      - name: RUN 'LIQUIBASE updateSQL IN A DOCKER CONTAINER'
#        uses: docker://liquibase/liquibase:latest
#        with:
#          args: --url=${{ secrets.DL_SNOWFLAKE_URL }} --changeLogFile=./dbscripts/masterChangeLog.xml --username=${{ secrets.SNOWFLAKE_USERNAME }} --password=${{ secrets.SF_PASSWORD }} --driver=${{ secrets.SF_DRIVER }} --defaultSchemaName=${{ secrets.SNOWFLAKE_SCHEMA_NAME }} updateSQL
#
#      - name: LIQUIBASE RUN UPDATE
#        uses: docker://liquibase/liquibase:latest
#        with:
#          args: --url=${{ secrets.DL_SNOWFLAKE_URL }} --changeLogFile=./dbscripts/masterChangeLog.xml --username=${{ secrets.SNOWFLAKE_USERNAME }} --password=${{ secrets.SF_PASSWORD }} --driver=${{ secrets.SF_DRIVER }} --defaultSchemaName=${{ secrets.SNOWFLAKE_SCHEMA_NAME }} update --logLevel=debug
